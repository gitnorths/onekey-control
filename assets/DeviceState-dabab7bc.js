import{m as G}from"./index-706eafad.js";import{b as K}from"./axios-585fb22d.js";import{_ as P}from"./uploadModal-599deec7.js";import{r as s,i as Q,e as i,f as o,d as m,w as l,a as T,b as a,h as $,c as _,k as X,g as k,F as y,u as Y,l as Z,_ as ee,o as le,t as ae}from"./index-c88748e7.js";const te={class:"dialog-footer"},oe={key:0},ne={__name:"AnalysisModal",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"确认信息"},width:{type:String,default:"50%"},url:{type:String,default:""}},emits:["cancel","confirm"],setup(F,{emit:S}){const U=S;let V=s();const D=F,h=s(!1),n=Q({station:"",voltage:"",bay:"",dev:"",operate:"",yxValue:""}),O=s([]),M=s([]),B=s([]),C=s([]),I=s([]),N=s([]),j=()=>{h.value=!0,uploadRef.value.submit()},R=()=>{U("cancel",!1)};return(W,u)=>{const g=i("el-option"),w=i("el-select"),x=i("el-form-item"),z=i("el-form"),E=i("el-button"),d=i("el-dialog");return o(),m(d,{modelValue:Y(V),"onUpdate:modelValue":u[6]||(u[6]=e=>Z(V)?V.value=e:V=e),title:D.title,width:D.width,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":"","modal-class":"dialog-import"},{footer:l(()=>[T("span",te,[a(E,{onClick:R},{default:l(()=>[$("取消")]),_:1}),a(E,{type:"primary",loading:h.value,onClick:j},{default:l(()=>[$(" 保存"),h.value?(o(),_("span",oe,"中")):X("",!0)]),_:1},8,["loading"])])]),default:l(()=>[a(z,{model:n,"label-width":"120px"},{default:l(()=>[a(x,{label:"站所"},{default:l(()=>[a(w,{modelValue:n.station,"onUpdate:modelValue":u[0]||(u[0]=e=>n.station=e),placeholder:"请选择站所"},{default:l(()=>[(o(!0),_(y,null,k(O.value,e=>(o(),m(g,{key:e.oid,label:e.name,value:e.oid},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(x,{label:"电压等级"},{default:l(()=>[a(w,{modelValue:n.voltage,"onUpdate:modelValue":u[1]||(u[1]=e=>n.voltage=e),placeholder:"请选择电压等级"},{default:l(()=>[(o(!0),_(y,null,k(M.value,e=>(o(),m(g,{key:e.oid,label:e.name,value:e.oid},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(x,{label:"间隔"},{default:l(()=>[a(w,{modelValue:n.bay,"onUpdate:modelValue":u[2]||(u[2]=e=>n.bay=e),placeholder:"请选择间隔"},{default:l(()=>[(o(!0),_(y,null,k(B.value,e=>(o(),m(g,{key:e.oid,label:e.name,value:e.oid},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(x,{label:"设备"},{default:l(()=>[a(w,{modelValue:n.dev,"onUpdate:modelValue":u[3]||(u[3]=e=>n.dev=e),placeholder:"请选择设备"},{default:l(()=>[(o(!0),_(y,null,k(C.value,e=>(o(),m(g,{key:e.oid,label:e.name,value:e.oid},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(x,{label:"操作"},{default:l(()=>[a(w,{modelValue:n.operate,"onUpdate:modelValue":u[4]||(u[4]=e=>n.operate=e),placeholder:"请选择操作"},{default:l(()=>[(o(!0),_(y,null,k(I.value,e=>(o(),m(g,{key:e.oid,label:e.name,value:e.oid},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(x,{label:"点位"},{default:l(()=>[a(w,{modelValue:n.yxValue,"onUpdate:modelValue":u[5]||(u[5]=e=>n.yxValue=e),placeholder:"请选择点位"},{default:l(()=>[(o(!0),_(y,null,k(N.value,e=>(o(),m(g,{key:e.oid,label:e.name,value:e.oid},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title","width"])}}};const se={class:"oc-box device-state"},ue={class:"oc-box__header"},de={class:"oc-box__main"},re={class:"device-state__text"},pe={__name:"DeviceState",setup(F){const S=s(null),U=s(null),V=s([]),D=s([{prop:"index",label:"序号",width:"100px"},{prop:"state",label:"状态"},{prop:"condition",label:"条件"},{prop:"parseResults",label:"解析结果"},{prop:"operator",label:"操作",width:"150px"}]),h=s([]),n=s(!1),O=s(null),M=s(null),B=s(null),C=s(!1),I=s(null),N=s(null),j=()=>{G("getStation").then(d=>{if(d.data.length>0){V.value=d.data.map(r=>({...r,label:r.name,value:r.oid}));const e=d.data[0];S.value=e.oid,U.value=e.name,R(e.name)}})},R=d=>{G("getDevstatus",{station:d}).then(e=>{if(!(e!=null&&e.data))return;h.value=[];for(let v=0;v<e.data.length;v++){const f=e.data[v].status;for(let c=0;c<f.length;c++){const b=f[c];b.parseMap.forEach(p=>{h.value.push({index:b.sequence,state:b.status,condition:p.voltage+p.bay+p.dev+p.operate+p.yxValue,parseResults:`${p.voltage}/${p.bay}/${p.dev}/${p.operate}/${p.yxValue}`})})}}const r=["index","state"];z(h.value,r)})},W=(d,e)=>{switch(d){case"station":{const r=V.value.find(v=>v.oid===e);U.value=r.name,R(r.name)}break}},u=()=>{n.value||(n.value=!n.value,O.value="设备态模型导入",M.value="550px",B.value=K+"/uploadDevstatus")},g=()=>{n.value=!1},w=()=>{C.value=!0,I.value="确认信息",N.value="450px"},x=()=>{C.value=!1};le(()=>{j()});const z=(d,e)=>{let r=[];e.forEach((v,f)=>{d.forEach(c=>{c.mergeCell=e;const b=`rowspan_${v}`;e.slice(0,f+1).every(p=>r[p]===c[p])?(c[b]=0,r[b]+=1):(c[b]=1,r=c)})})},E=({row:d,column:e,rowIndex:r,columnIndex:v})=>{if(d.mergeCell.includes(e.property)){const f=d[`rowspan_${e.property}`];return f?{rowspan:f,colspan:1}:{rowspan:0,colspan:0}}};return(d,e)=>{const r=i("el-option"),v=i("el-select"),f=i("el-form-item"),c=i("el-button"),b=i("el-form"),p=i("el-text"),L=i("dv-decoration-11"),q=i("el-table-column"),H=i("el-table");return o(),_("div",se,[T("div",ue,[a(b,{inline:!0},{default:l(()=>[a(f,{label:"站所"},{default:l(()=>[a(v,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=t=>S.value=t),placeholder:"请选择",clearable:"",onChange:e[1]||(e[1]=t=>W("station",t))},{default:l(()=>[(o(!0),_(y,null,k(V.value,t=>(o(),m(r,{key:t.oid,label:t.name,value:t.oid},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(f,null,{default:l(()=>[a(c,{type:"primary",onClick:u},{default:l(()=>[$(" 设备态导入 ")]),_:1})]),_:1})]),_:1})]),T("div",de,[T("div",re,[a(L,{style:{width:"500px",height:"60px"}},{default:l(()=>[a(p,{size:"large"},{default:l(()=>[$(ae(U.value)+"-设备态解析结果",1)]),_:1})]),_:1})]),a(H,{data:h.value,"span-method":E,style:{width:"100%"}},{default:l(()=>[(o(!0),_(y,null,k(D.value,(t,J)=>(o(),_(y,{key:J},[t.prop!="operator"?(o(),m(q,{key:0,prop:t.prop,label:t.label,width:t.width?t.width:null},null,8,["prop","label","width"])):(o(),m(q,{key:1,prop:t.prop,label:t.label,width:t.width?t.width:null},{default:l(A=>[a(c,{type:"success",size:"small",onClick:ie=>w(A.$index,A.row)},{default:l(()=>[$(" 确认 ")]),_:2},1032,["onClick"])]),_:2},1032,["prop","label","width"]))],64))),128))]),_:1},8,["data"])]),a(P,{modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value=t),title:O.value,width:M.value,url:B.value,onCancel:g},null,8,["modelValue","title","width","url"]),a(ne,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=t=>C.value=t),title:I.value,width:N.value,onCancel:x},null,8,["modelValue","title","width"])])}}},me=ee(pe,[["__scopeId","data-v-0199565f"]]);export{me as default};

import{m as B}from"./index-4bd6f736.js";import{_ as X,r as u,a as Y,o as Z,b as i,c as _,d as m,e as x,f as d,w as l,F as C,h as D,i as f,j as ee,E as M,k as ae,g as $}from"./index-b83d8487.js";const te={class:"oc-box device-state"},le={class:"oc-box__header"},oe={class:"oc-box__main"},ne={class:"dialog-footer"},se={key:0},de={__name:"DeviceState",setup(ue){const g=u(null),S=u(null),w=u([]),R=u([{prop:"index",label:"序号",width:"100px"},{prop:"state",label:"状态"},{prop:"condition",label:"条件"},{prop:"parseResults",label:"解析结果"},{prop:"operator",label:"操作",width:"150px"}]),y=u([]),j=u("设备态导入"),v=u(!1),b=u(!1),I=Y({}),V=u(),F=u("/api/uploadOptabInfo"),k=u([]),N=()=>{B("getStation").then(a=>{if(a.data.length>0){w.value=a.data.map(s=>({...s,label:s.name,value:s.oid}));const e=a.data[0];g.value=e.oid,S.value=e.name,E(e.name)}})},E=a=>{B("getDevstatus",{station:a}).then(e=>{if(!(e!=null&&e.data))return;for(let c=0;c<e.data.length;c++){const p=e.data[c].status;for(let o=0;o<p.length;o++){const r=p[o];r.parseMap.forEach(n=>{y.value.push({index:r.sequence,state:r.status,condition:n.voltage+n.inteval+n.dev+n.jieci+n.status,parseResults:`${n.voltage}/${n.inteval}/${n.dev}/${n.jieci}/“/${n.status}/”"`})})}}const s=["index","state"];P(y.value,s)})},T=(a,e)=>{switch(a){case"station":{const s=w.value.find(c=>c.oid===e);S.value=s.name,E(s.name)}break}},U=()=>{v.value=!0},L=(a,e)=>{console.log(a,e)},z=a=>{console.log(a)},O=a=>{var e;a.code==0&&((e=a==null?void 0:a.data)!=null&&e.length)?(b.value=!1,v.value=!1,M({message:"上传成功！",type:"success"})):M.error(a.desc)},q=(a,e)=>ae.confirm(`确定删除已选择的文件 - ${a.name} ?`,{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>!0,()=>!1),G=()=>{b.value=!0,V.value.submit()};Z(()=>{N()});const P=(a,e)=>{let s=[];e.forEach((c,p)=>{a.forEach(o=>{o.mergeCell=e;const r=`rowspan_${c}`;e.slice(0,p+1).every(n=>s[n]===o[n])?(o[r]=0,s[r]+=1):(o[r]=1,s=o)})})},A=({row:a,column:e,rowIndex:s,columnIndex:c})=>{if(a.mergeCell.includes(e.property)){const p=a[`rowspan_${e.property}`];return p?{rowspan:p,colspan:1}:{rowspan:0,colspan:0}}};return(a,e)=>{const s=i("el-option"),c=i("el-select"),p=i("el-form-item"),o=i("el-button"),r=i("el-form"),n=i("el-table-column"),H=i("el-table"),J=i("el-upload"),K=i("el-dialog");return _(),m("div",te,[x("div",le,[d(r,{inline:!0},{default:l(()=>[d(p,{label:"站所"},{default:l(()=>[d(c,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),placeholder:"请选择",clearable:"",onChange:e[1]||(e[1]=t=>T("station",t))},{default:l(()=>[(_(!0),m(C,null,D(w.value,t=>(_(),$(s,{key:t.oid,label:t.name,value:t.oid},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),d(p,null,{default:l(()=>[d(o,{type:"primary",onClick:U},{default:l(()=>[f(" 设备态导入 ")]),_:1})]),_:1})]),_:1})]),x("div",oe,[d(H,{data:y.value,"span-method":A,style:{width:"100%"}},{default:l(()=>[(_(!0),m(C,null,D(R.value,(t,Q)=>(_(),m(C,{key:Q},[t.prop!="operator"?(_(),$(n,{key:0,prop:t.prop,label:t.label,width:t.width?t.width:null},null,8,["prop","label","width"])):(_(),$(n,{key:1,prop:t.prop,label:t.label,width:t.width?t.width:null},{default:l(h=>[d(o,{type:"warning",size:"small",onClick:W=>a.handleEdit(h.$index,h.row)},{default:l(()=>[f(" 修正 ")]),_:2},1032,["onClick"]),d(o,{type:"success",size:"small",onClick:W=>a.handleEdit(h.$index,h.row)},{default:l(()=>[f(" 确认 ")]),_:2},1032,["onClick"])]),_:2},1032,["prop","label","width"]))],64))),128))]),_:1},8,["data"])]),d(K,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=t=>v.value=t),title:j.value,"modal-class":"dialog-import"},{footer:l(()=>[x("span",ne,[d(o,{onClick:e[3]||(e[3]=t=>v.value=!1)},{default:l(()=>[f("取消")]),_:1}),d(o,{type:"primary",disabled:k.value.length==0,loading:b.value,onClick:G},{default:l(()=>[f(" 上传"),b.value?(_(),m("span",se,"中")):ee("",!0)]),_:1},8,["disabled","loading"])])]),default:l(()=>[d(r,{model:I},{default:l(()=>[d(J,{ref_key:"uploadRef",ref:V,"file-list":k.value,"onUpdate:fileList":e[2]||(e[2]=t=>k.value=t),class:"upload-demo",action:F.value,"auto-upload":!1,multiple:"",accept:"file",limit:1,"on-preview":z,"on-remove":L,"before-remove":q,"on-success":O},{tip:l(()=>[]),default:l(()=>[d(o,{type:"primary"},{default:l(()=>[f("选择上传文件")]),_:1})]),_:1},8,["file-list","action"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},re=X(de,[["__scopeId","data-v-1d2d3c00"]]);export{re as default};

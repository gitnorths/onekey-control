import{m as v}from"./index-4bd6f736.js";import{r as o,a as ae,o as te,b as u,c as d,d as f,e as B,f as s,w as n,g as C,F as L,h as N,i as h,j as oe,E as R,k as ne}from"./index-b83d8487.js";const se={class:"oc-box"},ue={class:"oc-box__header"},de={class:"oc-box__main"},ce={key:1,class:"oc-empty"},ie={class:"dialog-footer"},re={key:0},fe={__name:"index",setup(pe){const y=o(null),k=o([]),T=o(null),M=o([]),F=o(null),w=o([]),V=o(null),_=o([]),p=o([]),b=o([]),j=o("模型导入"),m=o(!1),g=o(!1),I=ae({}),O=o(),P=o("/api/uploadModel"),x=o([]),$=()=>{v("getStation").then(l=>{if(l.data.length>0){k.value=l.data.map(a=>({...a,label:a.name,value:a.oid}));const e=l.data[0];y.value=e.oid,S(e.oid),D(e.name)}})},S=l=>{v("getVoltage",{oid:l}).then(e=>{e.data.length>0&&(M.value=e.data.map(a=>({...a,label:a.name,value:a.oid})))})},G=l=>{v("getBay",{oid:l}).then(e=>{e.data.length>0&&(w.value=e.data.map(a=>({...a,label:a.name,value:a.oid})))})},U=l=>{v("getSwitch",{oid:l}).then(e=>{e.data.length>0&&(_.value=e.data.map(a=>({...a,label:a.name,value:a.oid})))})},D=l=>{v("getModelInfo",{station:l}).then(e=>{if(b.value=[],p.value=[],!(e!=null&&e.data))return;const a=e.data[0][l],c=a[0];for(const i in c)if(Object.hasOwnProperty.call(c,i)){const r=c[i];b.value.push({prop:i,label:r})}a.shift(),p.value=a})},q=(l,e)=>{switch(l){case"station":if(T.value=null,F.value=null,V.value=null,e){S(e);const a=k.value.find(c=>c.oid===e);D(a.name)}else M.value=[],w.value=[],_.value=[],b.value=[],p.value=[];break;case"voltage":F.value=null,V.value=null,e?G(e):(w.value=[],_.value=[]);break;case"bay":V.value=null,e?U(e):_.value=[];break;case"device":e&&U(e);break}},z=()=>{m.value=!0},A=(l,e)=>{console.log(l,e)},H=l=>{console.log(l)},J=l=>{var e;console.log(l),l.code==0&&((e=l==null?void 0:l.data)!=null&&e.length)?(g.value=!1,m.value=!1,R({message:"上传成功！",type:"success"})):R.error(l.desc)},K=(l,e)=>ne.confirm(`确定删除已选择的文件 - ${l.name} ?`,{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>!0,()=>!1),Q=()=>{g.value=!0,O.value.submit()};return te(()=>{$()}),(l,e)=>{const a=u("el-option"),c=u("el-select"),i=u("el-form-item"),r=u("el-button"),E=u("el-form"),W=u("el-table-column"),X=u("el-table"),Y=u("el-empty"),Z=u("el-upload"),ee=u("el-dialog");return d(),f("div",se,[B("div",ue,[s(E,{inline:!0},{default:n(()=>[s(i,{label:"站所"},{default:n(()=>[s(c,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),placeholder:"请选择",clearable:"",onChange:e[1]||(e[1]=t=>q("station",t))},{default:n(()=>[(d(!0),f(L,null,N(k.value,t=>(d(),C(a,{key:t.oid,label:t.name,value:t.oid},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(i,null,{default:n(()=>[s(r,{type:"primary",onClick:z},{default:n(()=>[h("模型导入")]),_:1})]),_:1})]),_:1})]),B("div",de,[p.value.length>0?(d(),C(X,{key:0,data:p.value,style:{width:"100%"}},{default:n(()=>[(d(!0),f(L,null,N(b.value,(t,le)=>(d(),C(W,{prop:t.prop,label:t.label,width:t.width?t.width:null,key:le},null,8,["prop","label","width"]))),128))]),_:1},8,["data"])):(d(),f("div",ce,[s(Y,{description:"暂无数据"})]))]),s(ee,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=t=>m.value=t),title:j.value,"modal-class":"dialog-import"},{footer:n(()=>[B("span",ie,[s(r,{onClick:e[3]||(e[3]=t=>m.value=!1)},{default:n(()=>[h("取消")]),_:1}),s(r,{type:"primary",disabled:x.value.length==0,loading:g.value,onClick:Q},{default:n(()=>[h(" 上传"),g.value?(d(),f("span",re,"中")):oe("",!0)]),_:1},8,["disabled","loading"])])]),default:n(()=>[s(E,{model:I},{default:n(()=>[s(Z,{ref_key:"uploadRef",ref:O,"file-list":x.value,"onUpdate:fileList":e[2]||(e[2]=t=>x.value=t),class:"upload-demo",action:P.value,"auto-upload":!1,multiple:"",accept:"file",limit:1,"on-preview":H,"on-remove":A,"before-remove":K,"on-success":J},{tip:n(()=>[]),default:n(()=>[s(r,{type:"primary"},{default:n(()=>[h("选择上传文件")]),_:1})]),_:1},8,["file-list","action"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{fe as default};
